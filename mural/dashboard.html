<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Meus Murais • Mural de Homenagens</title>

<style>
:root{
  --bg:#f4f7ff;
  --surface:#ffffff;
  --surface-soft:#f9fbff;

  --text:#0f172a;
  --muted:#64748b;

  --primary:#1d9cf0;
  --accent:#22c55e;

  --radius-xl:30px;
  --radius-lg:18px;
  --shadow-soft:0 22px 70px rgba(15,23,42,.10);
  --transition:.2s ease;
}

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
}

body{
  min-height:100vh;
  background:
    radial-gradient(circle at 0 0,#e0f2fe 0,#f4f7ff 40%,#ffffff 100%);
  color:var(--text);
}

/* topo fixo simples */
.nav{
  position:sticky;
  top:0;
  z-index:10;
  backdrop-filter:blur(14px);
  background:linear-gradient(to bottom,rgba(244,247,255,.95),rgba(244,247,255,.85),transparent);
  border-bottom:1px solid rgba(148,163,184,.25);
}
.nav-inner{
  max-width:1080px;
  margin:0 auto;
  padding:12px 20px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.nav-left{
  display:flex;
  align-items:center;
  gap:10px;
}
.nav-logo{
  width:32px;
  height:32px;
  border-radius:999px;
  background:conic-gradient(from 160deg,#1d9cf0,#22c55e,#1d9cf0);
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-size:1rem;
  font-weight:700;
}
.nav-title{
  font-size:.95rem;
  font-weight:600;
}
.nav-sub{
  font-size:.8rem;
  color:var(--muted);
}

/* container */
.page{
  padding:26px 20px 70px;
  max-width:1080px;
  margin:0 auto;
}

/* cabeçalho + botão */
.top-bar{
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  margin-bottom:22px;
  gap:16px;
}
.top-title{
  font-size:1.9rem;
  font-weight:600;
}
.top-sub{
  font-size:.95rem;
  color:var(--muted);
  margin-top:4px;
}

/* botão criar */
.btn-create{
  background:linear-gradient(135deg,var(--primary),var(--accent));
  padding:11px 24px;
  color:#fff;
  font-size:.9rem;
  font-weight:600;
  border-radius:999px;
  border:none;
  cursor:pointer;
  box-shadow:0 10px 34px rgba(15,23,42,.22);
  transition:var(--transition);
  white-space:nowrap;
}
.btn-create:hover{
  transform:translateY(-2px);
  box-shadow:0 16px 46px rgba(15,23,42,.26);
}

/* resumo */
.summary{
  display:flex;
  flex-wrap:wrap;
  gap:14px;
  margin-bottom:26px;
}
.summary-card{
  flex:1 1 150px;
  min-width:150px;
  border-radius:20px;
  background:var(--surface);
  box-shadow:var(--shadow-soft);
  padding:12px 16px;
}
.summary-label{
  font-size:.78rem;
  color:var(--muted);
}
.summary-value{
  margin-top:4px;
  font-size:1.2rem;
  font-weight:600;
}

/* lista */
.mural-wrapper{
  border-radius:32px;
  padding:18px 16px 20px;
  background:
    radial-gradient(circle at 0 0,#e0f2fe88,transparent 55%),
    radial-gradient(circle at 100% 100%,#bbf7d088,transparent 55%),
    rgba(248,250,252,.9);
  box-shadow:0 26px 80px rgba(15,23,42,.18);
}
.mural-grid{
  display:flex;
  flex-direction:column;
  gap:18px;
}

/* cards */
.mural-card{
  background:var(--surface);
  border-radius:24px;
  padding:18px 18px 16px;
  box-shadow:0 14px 40px rgba(15,23,42,.08);
  display:flex;
  gap:16px;
  align-items:flex-start;
  transition:var(--transition);
}
.mural-card:hover{
  transform:translateY(-1px);
  box-shadow:0 22px 60px rgba(15,23,42,.18);
}

/* avatar */
.mural-avatar{
  width:46px;
  height:46px;
  border-radius:999px;
  background:#e0edff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.2rem;
  color:#1d4ed8;
  flex-shrink:0;
}

/* conteúdo card */
.mural-main{
  flex:1;
}
.mural-header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:10px;
  margin-bottom:6px;
}
.mural-name{
  font-size:1.05rem;
  font-weight:600;
}
.mural-extra{
  font-size:.8rem;
  color:var(--muted);
}

.status{
  font-size:.8rem;
  padding:4px 10px;
  border-radius:999px;
  background:#dcfce7;
  color:#15803d;
  font-weight:600;
}
.status-edit{
  background:#fff7d6;
  color:#a16207;
}
.status-enviado{
  background:#dbeafe;
  color:#1d4ed8;
}

.mural-info{
  font-size:.85rem;
  color:var(--muted);
  margin-top:4px;
}

/* ações */
.mural-actions{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top:10px;
}
.btn{
  border-radius:999px;
  padding:7px 14px;
  font-size:.8rem;
  cursor:pointer;
  border:1px solid transparent;
  transition:var(--transition);
}
.btn-outline{
  background:#fff;
  border-color:#dbeafe;
}
.btn-outline:hover{
  border-color:var(--primary);
  box-shadow:0 10px 26px rgba(15,23,42,.10);
}
.btn-primary{
  background:linear-gradient(135deg,var(--primary),var(--accent));
  color:#fff;
}
.btn-primary:hover{
  transform:translateY(-1px);
  box-shadow:0 16px 40px rgba(15,23,42,.20);
}
.btn-danger{
  background:#fee2e2;
  color:#b91c1c;
}
.btn-danger:hover{
  background:#fecaca;
}

/* estado vazio */
.empty{
  border-radius:24px;
  background:var(--surface);
  padding:26px 18px;
  text-align:center;
  color:var(--muted);
  font-size:.9rem;
  box-shadow:0 18px 50px rgba(15,23,42,.12);
}

/* ===== MODAL QR ===== */
.modal-overlay{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,.40);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:40;
  padding:16px;
}
.modal-hidden{display:none;}

.modal-card{
  max-width:720px;          /* mais largo */
  width:100%;
  border-radius:26px;
  background:
    radial-gradient(circle at 0 0,#e0f2feaa,transparent 55%),
    radial-gradient(circle at 100% 100%,#bbf7d0aa,transparent 60%),
    linear-gradient(to bottom,#ffffff,#f8fafc);
  box-shadow:0 26px 80px rgba(15,23,42,.45);
  padding:20px 20px 18px;
  animation:modalIn .2s ease-out;
}
@keyframes modalIn{
  from{opacity:0;transform:translateY(12px) scale(.97);}
  to{opacity:1;transform:translateY(0) scale(1);}
}
.modal-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  margin-bottom:12px;
}
.modal-title{
  font-size:1.2rem;
  font-weight:600;
}
.modal-sub{
  font-size:.85rem;
  color:var(--muted);
}

.modal-close{
  border:none;
  background:transparent;
  cursor:pointer;
  font-size:1.1rem;
  color:#64748b;
}

/* layout interno do modal */
.modal-body{
  margin-top:6px;
  display:grid;
  grid-template-columns:minmax(0,230px) minmax(0,1fr); /* não estoura o card */
  gap:16px;
}
@media(max-width:700px){
  .modal-body{grid-template-columns:1fr;}
}

/* bloco QR */
.modal-qr-box{
  border-radius:20px;
  background:#ffffff;
  border:1px solid #dbeafe;
  padding:10px 10px 12px;
  text-align:center;
}
.modal-qr-label{
  font-size:.78rem;
  color:var(--muted);
  margin-bottom:6px;
}
.modal-qr-img{
  width:210px;
  height:210px;
  max-width:100%;
  border-radius:18px;
  background:#f1f5f9;
}

/* bloco link / copiar */
.modal-link-box{
  border-radius:20px;
  background:#ffffff;
  border:1px solid #dbeafe;
  padding:10px 12px 10px;
  font-size:.82rem;
}
.modal-link-label{
  font-size:.8rem;
  color:var(--muted);
  margin-bottom:4px;
}
.modal-link-row{
  display:flex;
  gap:8px;
  align-items:center;
  margin-top:4px;
}
.modal-link-input{
  flex:1;
  min-width:0;                 /* importantíssimo p/ ellipsis funcionar */
  border-radius:999px;
  border:1px solid #dbeafe;
  background:#f9fbff;
  padding:7px 11px;
  font-size:.8rem;
  color:#0f172a;
  overflow:hidden;
  white-space:nowrap;
  text-overflow:ellipsis;
}
.modal-btn-copy{
  border-radius:999px;
  border:none;
  padding:7px 13px;
  font-size:.78rem;
  font-weight:600;
  cursor:pointer;
  background:linear-gradient(135deg,var(--primary),var(--accent));
  color:#fff;
  transition:var(--transition);
}
.modal-btn-copy:hover{
  transform:translateY(-1px);
  box-shadow:0 12px 30px rgba(15,23,42,.24);
}
.modal-name{
  margin-top:8px;
  font-size:.8rem;
  color:#0f172a;
}
.modal-name span{
  color:var(--muted);
}

/* responsivo geral */
@media(max-width:720px){
  .top-bar{flex-direction:column;align-items:flex-start;}
  .mural-card{flex-direction:column;}
}
</style>
</head>
<body>

<header class="nav">
  <div class="nav-inner">
    <div class="nav-left">
      <div class="nav-logo">♡</div>
      <div>
        <div class="nav-title">Mural de Homenagens</div>
        <div class="nav-sub">Área da família</div>
      </div>
    </div>
  </div>
</header>

<main class="page">

  <section class="top-bar">
    <div>
      <div class="top-title">Meus Murais</div>
      <div class="top-sub">Gerencie seus murais criados e acompanhe homenagens.</div>
    </div>

    <button class="btn-create" onclick="window.location='criar-mural.html'">
      + Criar novo mural
    </button>
  </section>

  <section class="summary">
    <div class="summary-card">
      <div class="summary-label">Total de murais</div>
      <div class="summary-value" id="statTotal">0</div>
    </div>
    <div class="summary-card">
      <div class="summary-label">Prontos</div>
      <div class="summary-value" id="statProntos">0</div>
    </div>
    <div class="summary-card">
      <div class="summary-label">Enviados à funerária</div>
      <div class="summary-value" id="statEnviados">0</div>
    </div>
  </section>

  <section class="mural-wrapper">
    <div id="empty" class="empty" style="display:none;">
      Você ainda não criou nenhum mural.<br>
      Clique em <strong>“Criar novo mural”</strong> para começar.
    </div>

    <div id="muralGrid" class="mural-grid"></div>
  </section>

</main>

<div id="qrModal" class="modal-overlay modal-hidden">
  <div class="modal-card">
    <div class="modal-header">
      <div>
        <div class="modal-title">Compartilhar mural</div>
        <div class="modal-sub">Use o QR Code ou copie o link para enviar para a família e para a funerária.</div>
      </div>
      <button class="modal-close" type="button" id="btnFecharModal" aria-label="Fechar">✕</button>
    </div>

    <div class="modal-body">
      <div class="modal-qr-box">
        <div class="modal-qr-label">Aponte a câmera para este código</div>
        <img id="qrImg" class="modal-qr-img" alt="QR Code do mural">
      </div>

      <div class="modal-link-box">
        <div class="modal-link-label">Link do mural</div>
        <div class="modal-link-row">
          <div id="linkMural" class="modal-link-input"></div>
          <button class="modal-btn-copy" type="button" id="btnCopiar">Copiar</button>
        </div>
        <div class="modal-name">
          <span>Mural:</span> <strong id="nomeMuralModal">—</strong>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const STORAGE_KEY = 'murais_mh';

function carregarMurais(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : [];
  }catch(e){
    return [];
  }
}
function salvarMurais(lista){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(lista));
}
function formatarData(iso){
  if(!iso) return '-';
  const d = new Date(iso);
  if(isNaN(d.getTime())) return '-';
  return d.toLocaleDateString('pt-BR');
}
function iniciais(nome){
  if(!nome) return '♡';
  const partes = nome.trim().split(' ');
  const first = partes[0]?.[0] || '';
  const last  = partes.length > 1 ? partes[partes.length-1][0] : '';
  return (first+last || first).toUpperCase();
}
function construirLinkMural(id){
  const base = window.location.origin && window.location.origin !== 'null'
    ? window.location.origin
    : '';
  // dashboard.html  →  homenagem.html
  const path = window.location.pathname.replace('dashboard.html','homenagem.html');
  return `${base}${path}?id=${encodeURIComponent(id)}`;
}


function atualizarResumo(murais){
  const total = murais.length;
  const prontos = murais.filter(m=>m.status === 'pronto' || !m.status).length;
  const enviados = murais.filter(m=>m.status === 'enviado').length;
  document.getElementById('statTotal').textContent = total;
  document.getElementById('statProntos').textContent = prontos;
  document.getElementById('statEnviados').textContent = enviados;
}

function renderizarMurais(){
  const grid = document.getElementById('muralGrid');
  const empty = document.getElementById('empty');
  const murais = carregarMurais();

  grid.innerHTML = '';
  atualizarResumo(murais);

  if(!murais.length){
    empty.style.display = 'block';
    return;
  }
  empty.style.display = 'none';

  murais
    .sort((a,b)=> new Date(b.atualizadoEm || b.criadoEm) - new Date(a.atualizadoEm || a.criadoEm))
    .forEach(mural=>{
      const card = document.createElement('div');
      card.className = 'mural-card';

      const statusClass =
        mural.status === 'enviado' ? 'status status-enviado' :
        mural.status === 'edicao'  ? 'status status-edit' :
        'status';

      const criado = formatarData(mural.criadoEm);
      const atualizado = formatarData(mural.atualizadoEm);

      const relacao = mural.relacao ? `• ${mural.relacao}` : '';
      const datas = (mural.nascimento || mural.falecimento)
        ? `${mural.nascimento ? formatarData(mural.nascimento) : '??'} – ${mural.falecimento ? formatarData(mural.falecimento) : '??'}`
        : '';

      card.innerHTML = `
        <div class="mural-avatar">${iniciais(mural.nome)}</div>

        <div class="mural-main">
          <div class="mural-header">
            <div>
              <div class="mural-name">${mural.nome || 'Mural sem nome'}</div>
              <div class="mural-extra">${datas} ${relacao}</div>
            </div>
            <div class="${statusClass}">
              ${mural.status === 'enviado' ? 'Enviado' :
                mural.status === 'edicao' ? 'Em edição' : 'Pronto'}
            </div>
          </div>

          <div class="mural-info">
            Criado em ${criado}
            ${atualizado && atualizado !== criado ? ` • Atualizado em ${atualizado}` : ''}
            <br>
            ${mural.privacidade === 'publico'
              ? 'Link público para compartilhar com a família.'
              : 'Apenas família e convidados.'}
          </div>

          <div class="mural-actions">
            <button class="btn btn-outline" data-action="ver" data-id="${mural.id}">Ver mural</button>
            <button class="btn btn-outline" data-action="editar" data-id="${mural.id}">Editar</button>
            <button class="btn btn-primary" data-action="qr" data-id="${mural.id}">Ver QR Code</button>
            <button class="btn btn-danger" data-action="excluir" data-id="${mural.id}">Excluir</button>
          </div>
        </div>
      `;

      grid.appendChild(card);
    });
}

/* modal */
const modal = document.getElementById('qrModal');
const qrImg = document.getElementById('qrImg');
const linkMuralDiv = document.getElementById('linkMural');
const nomeMuralModal = document.getElementById('nomeMuralModal');
const btnCopiar = document.getElementById('btnCopiar');

function abrirModalQR(mural){
  const link = construirLinkMural(mural.id);
  const qrUrl = 'https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=' + encodeURIComponent(link);

  qrImg.src = qrUrl;
  linkMuralDiv.textContent = link;
  nomeMuralModal.textContent = mural.nome || 'Mural sem nome';

  modal.classList.remove('modal-hidden');
}

function fecharModalQR(){
  modal.classList.add('modal-hidden');
}

document.addEventListener('DOMContentLoaded', ()=>{
  renderizarMurais();

  document.getElementById('muralGrid').addEventListener('click', (ev)=>{
    const btn = ev.target.closest('[data-action]');
    if(!btn) return;

    const id = btn.dataset.id;
    const action = btn.dataset.action;
    const murais = carregarMurais();
    const mural = murais.find(m=>m.id === id);

    if(action === 'editar'){
      window.location.href = `criar-mural.html?id=${id}`;
    }

    if(action === 'excluir'){
      if(confirm('Tem certeza que deseja excluir este mural?')){
        const novaLista = murais.filter(m=>m.id !== id);
        salvarMurais(novaLista);
        renderizarMurais();
      }
    }

    if(action === 'ver'){
      window.location.href = `mural.html?id=${id}`;
    }

    if(action === 'qr' && mural){
      abrirModalQR(mural);
    }
  });

  document.getElementById('btnFecharModal').addEventListener('click', fecharModalQR);
  modal.addEventListener('click', (e)=>{
    if(e.target === modal) fecharModalQR();
  });

  btnCopiar.addEventListener('click', async ()=>{
    const texto = linkMuralDiv.textContent.trim();
    if(!texto) return;
    try{
      await navigator.clipboard.writeText(texto);
      const original = btnCopiar.textContent;
      btnCopiar.textContent = 'Copiado!';
      setTimeout(()=>btnCopiar.textContent = original, 1500);
    }catch(e){
      alert('Não foi possível copiar automaticamente. Copie o link manualmente.');
    }
  });
});
</script>

</body>
</html>